<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HeartLink — помощник для детей с РАС</title>
<style>
  :root{
    --bg:#f6f7fb;--card:#ffffff;--text:#1f2430;--muted:#60708a;
    --accent:#4a67ff;--accent-2:#00b894;--warn:#ffb020;--danger:#ff5a5f;
    --border:#e4e7f2;--tab:#eef2ff;
  }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;background:var(--bg);color:var(--text)}
  .wrap{max-width:980px;margin:0 auto;padding:18px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:8px 0 14px}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#8aa0ff);display:grid;place-items:center;color:#fff;font-weight:700}
  h1{font-size:20px;margin:0}
  .tabs{display:flex;gap:10px;flex-wrap:wrap;position:sticky;top:0;padding:8px 0;background:var(--bg);z-index:5}
  .tab{border:1px solid var(--border);background:var(--tab);padding:8px 12px;border-radius:12px;color:var(--text);text-decoration:none}
  .tab.active{background:#fff;border-color:#cfd7ff;color:var(--accent);font-weight:600}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin:12px 0}
  h2{margin:4px 0 12px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1 1 280px}
  .btn{background:var(--accent);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:600}
  .btn.secondary{background:#edf1ff;color:var(--accent)}
  .btn.link{background:transparent;color:var(--accent);padding:0;border:none}
  .badge{display:inline-block;padding:2px 10px;border-radius:999px;font-size:12px;font-weight:700}
  .b-green{background:#e8fff5;color:#0a7a55}
  .b-yellow{background:#fff6e1;color:#9a6c00}
  .b-red{background:#ffeaea;color:#b00020}
  label{display:flex;gap:10px;align-items:flex-start;margin:6px 0}
  input[type="text"], input[type="number"], textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff}
  textarea{min-height:90px}
  .list{display:grid;gap:10px}
  .tip{border-left:4px solid var(--accent-2);padding-left:10px}
  .muted{color:var(--muted);font-size:14px}
  footer{padding:24px 0 50px;color:var(--muted);text-align:center}
  .navline{display:flex;gap:12px;flex-wrap:wrap}
  .pill{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;font-size:13px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:720px){.grid-2{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">H</div>
        <div>
          <h1>HeartLink — помощник семьи</h1>
          <div class="muted">Прототип школьной команды • офлайн, без отправки данных</div>
        </div>
      </div>
      <button class="btn secondary" id="exportAll">Экспорт данных</button>
    </header>

    <nav class="tabs">
      <a class="tab active" data-tab="symptoms">Чекер симптомов</a>
      <a class="tab" data-tab="assistant">Советник</a>
      <a class="tab" data-tab="diary">Дневник</a>
      <a class="tab" data-tab="messages">Сообщения</a>
      <a class="tab" data-tab="about">О проекте</a>
    </nav>

    <!-- SYMPTOMS -->
    <section class="tab-page" id="symptoms">
      <div class="card">
        <h2>Быстрая оценка состояния</h2>
        <p class="muted">Отметьте, что подходит прямо сейчас. Мы оценим уровень стресса и дадим идеи, что сделать.</p>
        <div class="grid-2">
          <div>
            <strong>Ввод</strong>
            <div>
              <label><input type="checkbox" class="sym"> Слишком шумно вокруг</label>
              <label><input type="checkbox" class="sym"> Яркий/мигающий свет</label>
              <label><input type="checkbox" class="sym"> Дискомфорт от одежды/прикосновений</label>
              <label><input type="checkbox" class="sym"> Смена рутины/переход</label>
              <label><input type="checkbox" class="sym"> Сон &lt; 7 часов</label>
              <label><input type="checkbox" class="sym"> Голоден(а) / пропущен приём пищи</label>
              <label><input type="checkbox" class="sym"> Признаки перегруза (закрывает уши, ходит туда‑сюда, стимминг ↑)</label>
              <label><input type="checkbox" class="sym"> Возможна боль (голова/живот)</label>
            </div>
            <label>Минут до следующего перехода?
              <input type="number" id="minutes" min="0" placeholder="например, 15">
            </label>
            <button class="btn" id="calc">Рассчитать уровень</button>
          </div>
          <div>
            <strong>Результат</strong>
            <div id="levelBox" class="card" style="padding:12px;background:#fafbff">
              <div id="levelText" class="badge b-green">Ожидаем низкий стресс</div>
              <div id="tips" class="list" style="margin-top:10px"></div>
            </div>
            <div class="muted">Это не диагноз. Это подсказка для родителей/наставников, что можно попробовать прямо сейчас.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ASSISTANT -->
    <section class="tab-page" id="assistant" style="display:none">
      <div class="card">
        <h2>Советник (офлайн)</h2>
        <p class="muted">Введите ситуацию коротко: «шумная перемена», «трудный переход домой», «боль в животе», «тревога перед уроком» и т.п.</p>
        <div class="row">
          <div class="col"><input id="q" type="text" placeholder="Опишите ситуацию..."></div>
          <div class="col" style="max-width:220px"><button class="btn" id="ask">Подобрать идеи</button></div>
        </div>
        <div id="ans" class="card" style="margin-top:12px;display:none"></div>
        <div class="navline muted"><span class="pill">ключевые слова: шум, свет, сенсорика, переход, школа, сон, боль, тревога, истерика</span></div>
      </div>
    </section>

    <!-- DIARY -->
    <section class="tab-page" id="diary" style="display:none">
      <div class="card">
        <h2>Дневник</h2>
        <div class="grid-2">
          <div>
            <label>Дата/время
              <input type="text" id="d_date" placeholder="авто" />
            </label>
            <label>Настроение/энергия
              <input type="text" id="d_mood" placeholder="спокойный, напряжение 6/10">
            </label>
            <label>Сенсорные факторы
              <input type="text" id="d_sens" placeholder="шумно, теснота, яркий свет">
            </label>
            <label>Сработало лучше всего
              <textarea id="d_helped" placeholder="наушники, пауза, вода, глубокие объятия и т.п."></textarea>
            </label>
            <div class="row">
              <button class="btn" id="saveLog">Сохранить запись</button>
              <button class="btn secondary" id="clearLog">Очистить всё</button>
            </div>
          </div>
          <div>
            <strong>История</strong>
            <div id="log" class="list"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- MESSAGES -->
    <section class="tab-page" id="messages" style="display:none">
      <div class="card">
        <h2>Сообщения</h2>
        <div class="list" id="feed"></div>
      </div>
    </section>

    <!-- ABOUT -->
    <section class="tab-page" id="about" style="display:none">
      <div class="card">
        <h2>О проекте</h2>
        <p>HeartLink — прототип, сделанный группой подростков. Цель — помочь семьям с РАС быстрее подбирать бытовые решения: снизить стресс, пройти «переходы», общаться с учителями и врачами. Все данные хранятся <strong>локально</strong> в браузере и никуда не отправляются.</p>
        <ul>
          <li>Функции: чекер симптомов, офлайн‑советник по ключевым словам, дневник с экспортом, лента полезных подсказок.</li>
          <li>Этика: решения не заменяют специалистов; при боли/травме срочно к врачу.</li>
          <li>Планы: добавить индивидуальные профили триггеров, экспорт PDF для школы/врачей, мультиязычие.</li>
        </ul>
      </div>
    </section>

    <footer>© 2025 HeartLink • школьный прототип • версия 1.0</footer>
  </div>

<script>
// ===== Tabs =====
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const id=t.dataset.tab;
    document.querySelectorAll('.tab-page').forEach(p=>p.style.display='none');
    document.getElementById(id).style.display='block';
    window.scrollTo({top:0,behavior:'smooth'});
  });
});

// ===== Symptom Checker =====
function calcLevel(){
  const checks=[...document.querySelectorAll('.sym')].filter(i=>i.checked).length;
  let mins = parseInt(document.getElementById('minutes').value||'0',10);
  let score = checks*2 + (mins<=10?3:mins<=20?1:0);
  let levelText=document.getElementById('levelText');
  const tipsEl=document.getElementById('tips');
  tipsEl.innerHTML='';
  let tips=[];
  if(score<=2){ levelText.className='badge b-green'; levelText.textContent='Низкий стресс: профилактика'; 
    tips=[
      'Предложите воду/перекус, мягкую ткань или любимый предмет.',
      'Договоритесь про маленькие шаги перед следующим переходом.',
      'Напомните про «тихую зону» или музыку через наушники.'
    ];
  } else if(score<=6){ levelText.className='badge b-yellow'; levelText.textContent='Средний стресс: поддержка';
    tips=[
      '5–10 мин. пауза: глубокое дыхание, «черепаха в панцире», мячик‑ёж.',
      'Снижайте стимулы: приглушить свет, уйти в коридор/уголок.',
      'Проговорите план: «сейчас 3 шага… я рядом, всё ок».'
    ];
  } else { levelText.className='badge b-red'; levelText.textContent='Высокий стресс: быстрое вмешательство';
    tips=[
      'Безопасность: увеличить дистанцию, убрать лишних людей.',
      'Короткие фразы и визуальные подсказки. Без вопросов, только предложения.',
      'Если есть боль/тревога — сообщить взрослому, при необходимости обратиться к врачу.'
    ];
  }
  tips.forEach(t=>{
    const li=document.createElement('div'); li.className='tip'; li.textContent='• '+t; tipsEl.appendChild(li);
  });
}
document.getElementById('calc').addEventListener('click',calcLevel);

// ===== Assistant (keyword rules, offline) =====
const rules=[
  {k:['шум','громко','перемена'], a:['Наушники/беруши, уйти в более тихое место на 5–10 мин.','Визуальный таймер до конца перемены.','Перед возвращением — «движение‑давление»: обнимашка/пресс‑упражнения по желанию.']},
  {k:['свет','ярк'], a:['Приглушить свет, рассадить вдали от окна/лампы.','Кепка/козырёк, очки с мягким затемнением.','Заменить мигающие экраны на статичные.']},
  {k:['переход','дом','урок','смена'], a:['Разбить на 3 мини‑шага с картинками/иконками.','Включить «переходную» музыку/таймер.','Договориться о награде после завершения.']},
  {k:['тревога','страх'], a:['Дыхание «4‑7‑8» вместе.','Фразы‑якоря: «Я в безопасности. Это пройдёт».','Сенсорный набор: мячик‑ёж, тяжёлое одеяло/жилет.']},
  {k:['боль','живот','голова'], a:['Проверить воду/перекус, найти тихое место.','Если боль сильная или новая — сообщить взрослому/врачу.','Отслеживать триггеры в дневнике.']},
  {k:['школа','учитель','класс'], a:['Перед уроком — «прайминг»: 1 мин. план на карточке.','Право на короткий выход с таймером.','Договориться о сигнале «нужна пауза».']},
  {k:['сон','устал','ночь'], a:['Рутина на ночь: тусклый свет, экран off за 60 мин.','Тёплая ванна/чай, тяжёлое одеяло при согласии.','Подъём и отбой в одно и то же время.']},
  {k:['истерика','крик','крушит'], a:['Сначала безопасность и тишина: меньше слов, больше присутствия.','Не спорить. Мягко отзеркалить эмоцию: «я вижу, что сложно».','После — восстановление и короткий разбор без оценки.']},
];
function advise(q){
  q=q.toLowerCase();
  let bag=[];
  for(const r of rules){ if(r.k.some(w=>q.includes(w))) bag=bag.concat(r.a); }
  if(bag.length===0){
    bag=['Опишите ключевые слова (например, «шумная перемена», «переход домой», «тревога перед уроком»).',
         'Начните с базовых потребностей: вода, перекус, туалет, пауза.',
         'Уменьшите стимулы: свет, шум, теснота. Визуальный таймер и маленькие шаги.'];
  }
  return '<div class="list">'+bag.map(x=>`<div class="tip">• ${x}</div>`).join('')+'</div>';
}
document.getElementById('ask').addEventListener('click',()=>{
  const q=document.getElementById('q').value.trim();
  const box=document.getElementById('ans');
  if(!q){ box.style.display='block'; box.innerHTML='<span class="muted">Опишите ситуацию одной фразой…</span>'; return; }
  box.style.display='block';
  box.innerHTML = '<div class="muted">Запрос: '+q+'</div>' + advise(q);
});

// ===== Diary =====
const LS_KEY='heartlink_diary_v1';
function loadDiary(){
  const arr=JSON.parse(localStorage.getItem(LS_KEY)||'[]');
  const log=document.getElementById('log'); log.innerHTML='';
  arr.slice().reverse().forEach(entry=>{
    const d=document.createElement('div'); d.className='card';
    d.innerHTML=`<div><strong>${entry.date}</strong></div>
      <div class="muted">настроение: ${entry.mood||'-'}</div>
      <div class="muted">сенсорика: ${entry.sens||'-'}</div>
      <div>${entry.helped?('Что помогло: '+entry.helped):''}</div>`;
    log.appendChild(d);
  });
}
function saveDiary(){
  const arr=JSON.parse(localStorage.getItem(LS_KEY)||'[]');
  const now = new Date().toLocaleString('ru-RU');
  const entry={
    date: document.getElementById('d_date').value || now,
    mood: document.getElementById('d_mood').value,
    sens: document.getElementById('d_sens').value,
    helped: document.getElementById('d_helped').value
  };
  arr.push(entry);
  localStorage.setItem(LS_KEY, JSON.stringify(arr));
  document.getElementById('d_date').value='';
  document.getElementById('d_mood').value='';
  document.getElementById('d_sens').value='';
  document.getElementById('d_helped').value='';
  loadDiary();
}
document.getElementById('saveLog').addEventListener('click',saveDiary);
document.getElementById('clearLog').addEventListener('click',()=>{
  if(confirm('Удалить все записи дневника?')){ localStorage.removeItem(LS_KEY); loadDiary(); }
});
loadDiary();

// ===== Messages (simple feed) =====
const msgs=[
 {t:'Если меняться сложно', b:'Нарисуйте 3 шага перехода: «собрать вещи → выйти из класса → вода». Покажите таймер на 3–5 минут.'},
 {t:'Сенсорная пауза', b:'5‑минутный «сенсорный коктейль»: давление ладонями о стену, тяжёлый предмет, глубокие объятия — по согласию.'},
 {t:'В школе', b:'Договоритесь с учителем о карточке «нужна пауза». Ребёнок показывает её и выходит на 3 минуты в тихое место.'},
 {t:'Питание/вода', b:'Маленькая бутылка воды и закуска в рюкзаке сокращают всплески раздражения из‑за голода/жажды.'}
];
const feed=document.getElementById('feed');
msgs.forEach(m=>{
  const d=document.createElement('div'); d.className='card';
  d.innerHTML=`<strong>${m.t}</strong><div class="muted">${m.b}</div>`;
  feed.appendChild(d);
});

// ===== Export all local data =====
document.getElementById('exportAll').addEventListener('click',()=>{
  const data={diary: JSON.parse(localStorage.getItem(LS_KEY)||'[]')};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='heartlink_export.json'; a.click();
  URL.revokeObjectURL(a.href);
});
</script>
</body>
</html>
